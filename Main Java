import java.sql.*;
import java.util.Scanner;
import java.util.logging.Level;
import java.util.logging.Logger;

public class testing1 { // JDBC driver name and database URL
   static final String JDBC_DRIVER = "org.apache.derby.jdbc.ClientDriver";
   static final String DB_URL = "jdbc:derby://localhost:1527/sqlPractice1";

   //  Database credentials
   static final String USER = "user001";
   static final String PASS = "PASS";
   
   ////////////////////////
     static String group_name;
     static String head_writer; 
     static String year_formed;          
     static String subject;
     static String book_title;
     static String publisher_name;
     static String year_published;
     static String number_pages;
     static String publisher_address;
     static String publisher_phone;
     static String publisher_email;
   //////////////////////
     
     static Connection conn = null;
     
     
   public static void main(String[] args) throws SQLException {
   Statement stmt = null;
       
   try {
   //STEP 2: Register JDBC driver
      Class.forName(JDBC_DRIVER);

      //STEP 3: Open a connection
      System.out.println("Connecting to database...");
      conn = DriverManager.getConnection(DB_URL,USER,PASS);
      stmt = conn.createStatement();   
      
      System.out.println("Connected database successfully...");
      
      //databaseMenu();
      
      //publisherInfo();
      //listBookTitles();
      //listOneBookAll();
      
      //STEP 4: Execute a query
      System.out.println("Creating table...");
     databaseMenu();
     
       //rs.close();
      
      //rs.close();
      stmt.close();
      conn.close();
   }catch(SQLException se){
      //Handle errors for JDBC
      se.printStackTrace();
   }catch(Exception e){
      //Handle errors for Class.forName
      e.printStackTrace();
   }finally{
      //finally block used to close resources
      try{
         if(stmt!=null)
            stmt.close();
      }catch(SQLException se2){
      }// nothing we can do
      try{
         if(conn!=null)
            conn.close();
      }catch(SQLException se){
         se.printStackTrace();
      }//end finally try
   }//end try
}//end main

public static void databaseMenu() throws SQLException
{
    int userInput;
    Scanner scan = new Scanner(System.in);
    System.out.println("");
    System.out.println("----------------------------------------------------------------------------");
    System.out.println("Enter number for option (Enter any number not in the options to exit)");
    System.out.println("List all writing groups             [1]");
    System.out.println("List all data for given group       [2]");
    System.out.println("List all publishers                 [3]");
    System.out.println("List all data for a given publisher [4]");
    System.out.println("List all book titles                [5]");
    System.out.println("List all data for a single book     [6]");
    System.out.println("Insert a new book                   [7]");
    System.out.println("Insert new publisher (update books) [8]");
    System.out.println("Remove a book                       [9]");
    System.out.println("");
    System.out.print("Enter choice: ");
    userInput = scan.nextInt();
    System.out.println("----------------------------------------------------------------------------");
    
    
    if(userInput < 1 || userInput > 9)
    {
        System.out.println("GoodBye!");
        return;
    }
    
    switch (userInput) 
    {
        case 1:
            listAllWritingGroups();
            break;
        case 2:
            listAllDataForGroup();
            break;
        case 3:
            listAllPublishers();
            break;
        case 4:
            listPublisherInfo();
            break;
        case 5:
            listBookTitles();
            break;
        case 6:
            listOneBookInfo();
            break;
        case 7:
            insertNewBook();
            break;
        case 8:
            newPubAndUpdate();
            break;
        default:   
            removeBook();
    }
}

public static void listAllWritingGroups() throws SQLException  ////////////////////YOUR NUMBER 1 NHAT
{
    Statement stmt = conn.createStatement();
    
    String sql = "SELECT groupName FROM WritingGroups";  
    
    ResultSet rs = stmt.executeQuery(sql);

    System.out.println("/////////////////// Listing All Writing Groups ///////////////////");
    while(rs.next())
    {
         String titleBook = rs.getString("groupName");
         System.out.println("Group Name: " + titleBook + " ");
    }
    
    rs.close();
    stmt.close();  
    databaseMenu();
}

public static void listAllDataForGroup() throws SQLException  //////////////////////YOUR NUMBER 2 NHAT
{
   String temp, userGroupName;
    
    temp = "Group Name";
    
    userGroupName = getUserInput(temp);
   
    
    String check_query = "SELECT groupName FROM WritingGroups WHERE groupName = ?";
            PreparedStatement check_stmt = conn.prepareStatement(check_query);
            check_stmt.setString(1, userGroupName);
            ResultSet result = check_stmt.executeQuery();
            if (!result.next()) {
                System.out.println("Group " + userGroupName + " does not exist");
                result.close();
                check_stmt.close();
                databaseMenu();
                return;
            }
            
    String sql = "SELECT * FROM WRITINGGROUPS NATURAL JOIN PUBLISHERS NATURAL JOIN BOOKS WHERE groupName = ?";  
    PreparedStatement pstmt = null; 
    pstmt = conn.prepareStatement(sql);
    pstmt.setString(1, userGroupName);
      
    ResultSet rs = pstmt.executeQuery();
      
      System.out.println("///////////////////" + userGroupName + " information///////////////////");
      while(rs.next())
      {
         group_name = rs.getString("GroupName");
         head_writer = rs.getString("HeadWriter");
         year_formed = rs.getString("YearFormed");
         subject = rs.getString("Subject");
         book_title = rs.getString("BookTitle");
         publisher_name = rs.getString("PublisherName");
         year_published = rs.getString("YearPublished");
         number_pages = rs.getString("NumberPages");
         publisher_address = rs.getString("PublisherAddress");
         publisher_phone = rs.getString("PublisherPhone");
         publisher_email = rs.getString("PublisherEmail");
    
         System.out.print(" | Book Title: " + book_title + " ");
         System.out.print(" | Year Published: " + year_published + " ");
         System.out.print(" | Number Pages: " + number_pages + " ");
         System.out.print(" | Group name: " + group_name + " ");
         System.out.print(" | Head Writer: " + head_writer + " ");
         System.out.print(" | Year Formed: " + year_formed + " ");
         System.out.print(" | Subject: " + subject + " ");
         System.out.print(" | Publisher Name: " + publisher_name + " ");
         System.out.print(" | Publisher Address: " + publisher_address + " ");
         System.out.print(" | Publisher Phone: " + publisher_phone + " ");
         System.out.println(" | Publisher email: " + publisher_email + " ");
      }
      
      
       rs.close();
       result.close();
       check_stmt.close();
       pstmt.close();
       
       databaseMenu();
      
}

public static void listAllPublishers() throws SQLException   ///////////////////////YOUR NUMBER 3 NHAT
{
    Statement stmt = conn.createStatement();
    
    String sql = "SELECT publisherName FROM Publishers";  
    
    ResultSet rs = stmt.executeQuery(sql);

    System.out.println("/////////////////// Listing All Publishers ///////////////////");
    while(rs.next())
    {
         String pName = rs.getString("publisherName");
         System.out.println("Publisher Name: " + pName + " ");
    }
    
    rs.close();
    stmt.close();  
    databaseMenu();
}

public static void listPublisherInfo() throws SQLException   ////////////////////NUMBER 4
{
    PreparedStatement pstmt = null;
    
    String temp = "Publisher Name";
    String userPublisherName = getUserInput(temp);
    
    String check_query = "SELECT publisherName FROM Publishers NATURAL JOIN BOOKS where publisherName = ?";
            PreparedStatement check_stmt = conn.prepareStatement(check_query);
            check_stmt.setString(1, userPublisherName);
            ResultSet result = check_stmt.executeQuery();
            if (!result.next()) {
                System.out.println("Publisher Name " + userPublisherName + "does not exist");
                result.close();
                databaseMenu();
                return;
            }
    
    
    String sql = "SELECT * FROM WRITINGGROUPS NATURAL JOIN PUBLISHERS NATURAL JOIN BOOKS WHERE publisherName = ?";  
      
    pstmt = conn.prepareStatement(sql);
    pstmt.setString(1, userPublisherName);
      
    ResultSet rs = pstmt.executeQuery();
      
      System.out.println("///////////////////" + userPublisherName + " information///////////////////");
      while(rs.next())
      {
         group_name = rs.getString("GroupName");
         head_writer = rs.getString("HeadWriter");
         year_formed = rs.getString("YearFormed");
         subject = rs.getString("Subject");
         book_title = rs.getString("BookTitle");
         publisher_name = rs.getString("PublisherName");
         year_published = rs.getString("YearPublished");
         number_pages = rs.getString("NumberPages");
         publisher_address = rs.getString("PublisherAddress");
         publisher_phone = rs.getString("PublisherPhone");
         publisher_email = rs.getString("PublisherEmail");
    
         System.out.print(" | Publisher Name: " + publisher_name + " ");
         System.out.print(" | Publisher Address: " + publisher_address + " ");
         System.out.print(" | Publisher Phone: " + publisher_phone + " ");
         System.out.print(" | Publisher email: " + publisher_email + " ");
         System.out.print(" | Book Title: " + book_title + " ");
         System.out.print(" | Year Published: " + year_published + " ");
         System.out.print(" | Number Pages: " + number_pages + " ");
         System.out.print(" | Group name: " + group_name + " ");
         System.out.print(" | Head Writer: " + head_writer + " ");
         System.out.print(" | Year Formed: " + year_formed + " ");
         System.out.println(" | Subject: " + subject + " ");
      }
      
       result.close();
       rs.close();
       pstmt.close();
       databaseMenu();
      
}

   
public static void listBookTitles() throws SQLException
{
    Statement stmt = conn.createStatement();
    
    String sql = "SELECT bookTitle FROM BOOKS";  
    
    ResultSet rs = stmt.executeQuery(sql);

    System.out.println("/////////////////// Listing All Book Titles ///////////////////");
    while(rs.next())
    {
         String titleBook = rs.getString("bookTitle");
         System.out.println("Book Title: " + titleBook + " ");
    }
    
    rs.close();
    stmt.close();  
    databaseMenu();
    
}

public static void listOneBookInfo() throws SQLException
{
    String temp, userBookTitle, userGroupName, userPublisherName;
    
    temp = "Book Title";
    
    userBookTitle = getUserInput(temp);
    
    temp = "Group Name";
    
    userGroupName = getUserInput(temp);
    
    temp = "Publisher Name";
    
    userPublisherName = getUserInput(temp);
    
    String check_query = "SELECT bookTitle FROM BOOKS where bookTitle = ?";
            PreparedStatement check_stmt = conn.prepareStatement(check_query);
            check_stmt.setString(1, userBookTitle);
            ResultSet result = check_stmt.executeQuery();
            if (!result.next()) {
                System.out.println("Book titled  " + userBookTitle + " does not exist");
                result.close();
                databaseMenu();
                return;
            }
            
    
    check_query = "SELECT groupName FROM WritingGroups NATURAL JOIN BOOKS where groupName = ?";
            check_stmt = conn.prepareStatement(check_query);
            check_stmt.setString(1, userGroupName);
            result = check_stmt.executeQuery();
            if (!result.next()) {
                System.out.println("Group name " + userGroupName + "does not exist, , or doesn't match book title " + userBookTitle);
                result.close();
                databaseMenu();                
                return;
            }
    
    check_query = "SELECT publisherName FROM Publishers NATURAL JOIN BOOKS where publisherName = ?";
            check_stmt = conn.prepareStatement(check_query);
            check_stmt.setString(1, userPublisherName);
            result = check_stmt.executeQuery();
            if (!result.next()) {
                System.out.println("Publisher Name " + userPublisherName + "does not exist, or doesn't match book title " + userBookTitle);
                result.close();
                databaseMenu();
                return;
            }
    
    String sql = "SELECT * FROM WRITINGGROUPS NATURAL JOIN PUBLISHERS NATURAL JOIN BOOKS WHERE bookTitle = ?";  
    PreparedStatement pstmt = null; 
    pstmt = conn.prepareStatement(sql);
    pstmt.setString(1, userBookTitle);
      
    ResultSet rs = pstmt.executeQuery();
      
      System.out.println("///////////////////" + userBookTitle + " information///////////////////");
      while(rs.next())
      {
         group_name = rs.getString("GroupName");
         head_writer = rs.getString("HeadWriter");
         year_formed = rs.getString("YearFormed");
         subject = rs.getString("Subject");
         book_title = rs.getString("BookTitle");
         publisher_name = rs.getString("PublisherName");
         year_published = rs.getString("YearPublished");
         number_pages = rs.getString("NumberPages");
         publisher_address = rs.getString("PublisherAddress");
         publisher_phone = rs.getString("PublisherPhone");
         publisher_email = rs.getString("PublisherEmail");
    
         System.out.print("Book Title: " + book_title + " ");
         System.out.print(" | Year Published: " + year_published + " ");
         System.out.print(" | Number Pages: " + number_pages + " ");
         System.out.print(" | Group name: " + group_name + " ");
         System.out.print(" | Head Writer: " + head_writer + " ");
         System.out.print(" | Year Formed: " + year_formed + " ");
         System.out.print(" | Subject: " + subject + " ");
         System.out.print(" | Publisher Name: " + publisher_name + " ");
         System.out.print(" | Publisher Address: " + publisher_address + " ");
         System.out.print(" |Publisher Phone: " + publisher_phone + " ");
         System.out.println(" | Publisher email: " + publisher_email + " ");
      }
      
      
       rs.close();
       result.close();
       check_stmt.close();
       pstmt.close();
       
       databaseMenu();
      

}

public static void insertNewBook() throws SQLException ////////////////////////////////////////
{
    System.out.println("In case 7");
    databaseMenu();
}

public static void newPubAndUpdate() throws SQLException  /////////////////////////////////////////////////
{
    System.out.println("In case 8");
    databaseMenu();
}

public static void removeBook() throws SQLException
{
    System.out.println("In case 9");
    databaseMenu();
}

public static String getUserInput(String temp)
{
    String userInput;
    Scanner scan = new Scanner(System.in);
    System.out.print("Enter " + temp + ": ");
    userInput = scan.nextLine();
    return userInput;
}
   
}
